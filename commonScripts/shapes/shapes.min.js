function Cylinder(t,s,h,i){Shape3D.call(this,t,s),this.radius=h,this.halfHeight=i}function QuadXY(t,s,h){Shape3D.call(this,t,s),this.halfHeight=h}function QuadXZ(t,s,h){Shape3D.call(this,t,s),this.halfHeight=h}function Sphere(t,s,h){Shape3D.call(this,t,s),this.radius=h}var ShapeType=Object.freeze({CYLINDER:0,SPHERE:1,QUADXY:2,QUADXZ:3,NUM_SHAPE_TYPES:4}),Shape3D=function(t,s){this.longitudeBands=t,this.latitudeBands=s,this.vbo=null};Shape3D.prototype.bindBuffer=function(t,s,h,i){if(this.vbo){var e=Float32Array.BYTES_PER_ELEMENT,u=e*this.vbo.itemSize;t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.vertexAttribPointer(s,3,t.FLOAT,!1,u,0),this.vbo.itemSize>5&&t.vertexAttribPointer(h,3,t.FLOAT,!1,u,3*e),5==this.vbo.itemSize?t.vertexAttribPointer(i,2,t.FLOAT,!1,u,3*e):8==this.vbo.itemSize&&t.vertexAttribPointer(i,2,t.FLOAT,!1,u,6*e)}},Shape3D.prototype.render=function(t){this.vbo&&t.drawArrays(t.TRIANGLE_STRIP,0,this.vbo.numItems)},Shape3D.calcIntersectDistances=function(t,s,h){var i=s*s-4*t*h;return Math.abs(i)<1e-4?[s/(2*t)]:0>i?[]:[(s+i)/(2*t),(s-i)/(2*t)]},Cylinder.prototype=Object.create(Shape3D.prototype),Cylinder.prototype.constructor=Cylinder,Cylinder.prototype.createVBO=function(t,s,h){for(var i,e,u=[],a=1,p=0,r=1,o=1-1/this.longitudeBands,n=2*Math.PI/this.longitudeBands,d=Math.cos(n),c=Math.sin(n),l=1;l<=this.longitudeBands;l++){for(var f=0;f<=this.latitudeBands;f++)i=f/this.latitudeBands*this.halfHeight*2-this.halfHeight,e=1-f/this.latitudeBands,u.push(d*this.radius),u.push(i),u.push(c*this.radius),s&&(u.push(d),u.push(0),u.push(c)),h&&(u.push(o),u.push(e)),u.push(a*this.radius),u.push(i),u.push(p*this.radius),s&&(u.push(a),u.push(0),u.push(p)),h&&(u.push(r),u.push(e));l<this.longitudeBands&&(u.push(a*this.radius),u.push(i),u.push(p*this.radius),s&&(u.push(a),u.push(0),u.push(p)),h&&(u.push(r),u.push(e)),a=d,p=c,r=o,n=2*(l+1)*Math.PI/this.longitudeBands,d=Math.cos(n),c=Math.sin(n),o=1-(l+1)/this.longitudeBands,u.push(d*this.radius),u.push(-this.halfHeight),u.push(c*this.radius),s&&(u.push(d),u.push(0),u.push(c)),h&&(u.push(o),u.push(1)))}this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(u),t.STATIC_DRAW),this.vbo.itemSize=3,s&&(this.vbo.itemSize+=3),h&&(this.vbo.itemSize+=2),this.vbo.numItems=u.length/this.vbo.itemSize},Cylinder.intersectsRay=function(t,s,h,i){var e=vec3.create(),u=vec3.create(),a=vec3.create(),p=vec3.create();vec3.subtract(e,h,i),vec3.subtract(u,t,i),vec3.cross(a,s,e),vec3.cross(p,u,e);var r=vec3.dot(a,a),o=2*vec3.dot(a,p),n=vec3.dot(p,p)-vec3.dot(e,e),d=Shape3D.calcIntersectDistances(r,o,n);return d.length>0?!0:!1},QuadXY.prototype=Object.create(Shape3D.prototype),QuadXY.prototype.constructor=QuadXY,QuadXY.prototype.createVBO=function(t,s,h){for(var i,e,u=[],a=-this.halfHeight,p=0,r=1/this.longitudeBands,o=r*this.halfHeight*2-this.halfHeight,n=1;n<=this.longitudeBands;n++){for(var d=0;d<=this.latitudeBands;d++)i=d/this.latitudeBands*this.halfHeight*2-this.halfHeight,e=1-d/this.latitudeBands,u.push(a),u.push(i),u.push(0),s&&(u.push(0),u.push(0),u.push(1)),h&&(u.push(p),u.push(e)),u.push(o),u.push(i),u.push(0),s&&(u.push(0),u.push(0),u.push(1)),h&&(u.push(r),u.push(e));n<this.longitudeBands&&(u.push(o),u.push(i),u.push(0),s&&(u.push(0),u.push(0),u.push(1)),h&&(u.push(p),u.push(e)),a=o,p=r,r=(n+1)/this.longitudeBands,o=r*this.halfHeight*2-this.halfHeight,u.push(a),u.push(-this.halfHeight),u.push(0),s&&(u.push(0),u.push(0),u.push(1)),h&&(u.push(r),u.push(1)))}this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(u),t.STATIC_DRAW),this.vbo.itemSize=3,s&&(this.vbo.itemSize+=3),h&&(this.vbo.itemSize+=2),this.vbo.numItems=u.length/this.vbo.itemSize},QuadXY.intersectsRay=function(){return!1},QuadXZ.prototype=Object.create(Shape3D.prototype),QuadXZ.prototype.constructor=QuadXZ,QuadXZ.prototype.createVBO=function(t,s,h){for(var i,e,u=[],a=-this.halfHeight,p=0,r=1/this.longitudeBands,o=r*this.halfHeight*2-this.halfHeight,n=1;n<=this.longitudeBands;n++){for(var d=0;d<=this.latitudeBands;d++)i=d/this.latitudeBands*this.halfHeight*2-this.halfHeight,e=1-d/this.latitudeBands,u.push(o),u.push(0),u.push(i),s&&(u.push(0),u.push(1),u.push(0)),h&&(u.push(r),u.push(e)),u.push(a),u.push(0),u.push(i),s&&(u.push(0),u.push(1),u.push(0)),h&&(u.push(p),u.push(e));n<this.longitudeBands&&(u.push(a),u.push(0),u.push(i),s&&(u.push(0),u.push(1),u.push(0)),h&&(u.push(p),u.push(e)),a=o,p=r,r=(n+1)/this.longitudeBands,o=r*this.halfHeight*2-this.halfHeight,u.push(o),u.push(0),u.push(-this.halfHeight),s&&(u.push(0),u.push(1),u.push(0)),h&&(u.push(r),u.push(1)))}this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(u),t.STATIC_DRAW),this.vbo.itemSize=3,s&&(this.vbo.itemSize+=3),h&&(this.vbo.itemSize+=2),this.vbo.numItems=u.length/this.vbo.itemSize},QuadXZ.intersectsRay=function(){return!1},Sphere.prototype=Object.create(Shape3D.prototype),Sphere.prototype.constructor=Sphere,Sphere.prototype.createVBO=function(t,s,h){var i,e,u,a,p,r,o,n,d,c,l,f=[],v=0,b=1;c=1-1/this.longitudeBands;for(var B=1;B<=this.longitudeBands;B++){i=2*B*Math.PI/this.longitudeBands,e=Math.sin(i),u=Math.cos(i),f.push(0),f.push(1*this.radius),f.push(0),s&&(f.push(0),f.push(1),f.push(0)),h&&(f.push(c),f.push(0));for(var g=1;g<this.latitudeBands;g++)a=g*Math.PI/this.latitudeBands,p=Math.sin(a),r=Math.cos(a),o=u*p,n=r,d=e*p,c=1-B/this.longitudeBands,l=g/this.latitudeBands,f.push(o*this.radius),f.push(n*this.radius),f.push(d*this.radius),s&&(f.push(o),f.push(n),f.push(d)),h&&(f.push(c),f.push(l)),o=b*p,n=r,d=v*p,c=1-(B-1)/this.longitudeBands,l=g/this.latitudeBands,f.push(o*this.radius),f.push(n*this.radius),f.push(d*this.radius),s&&(f.push(o),f.push(n),f.push(d)),h&&(f.push(c),f.push(l));f.push(0),f.push(-1*this.radius),f.push(0),s&&(f.push(0),f.push(-1),f.push(0)),h&&(f.push(c),f.push(1)),B<this.longitudeBands&&(f.push(0),f.push(-1*this.radius),f.push(0),s&&(f.push(0),f.push(-1),f.push(0)),h&&(f.push(c),f.push(1)),c=1-B/this.longitudeBands,f.push(0),f.push(1*this.radius),f.push(0),s&&(f.push(0),f.push(1),f.push(0)),h&&(f.push(c),f.push(0))),v=e,b=u}this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(f),t.STATIC_DRAW),this.vbo.itemSize=3,s&&(this.vbo.itemSize+=3),h&&(this.vbo.itemSize+=2),this.vbo.numItems=f.length/this.vbo.itemSize},Sphere.intersectsRay=function(t,s,h,i){var e=vec4.create();vec3.subtract(e,t,h);var u=2*vec3.dot(s,e),h=vec3.dot(e,e)-i*i,a=Shape3D.calcIntersectDistances(1,u,h);return a.length>0?!0:!1};
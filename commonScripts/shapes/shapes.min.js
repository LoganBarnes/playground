function Quad(t,s,h){Shape3D.call(this,t,s),this.halfHeight=h}function Cylinder(t,s,h,i){Shape3D.call(this,t,s),this.radius=h,this.halfHeight=i}function Sphere(t,s,h){Shape3D.call(this,t,s),this.radius=h}var ShapeType=Object.freeze({CYLINDER:0,SPHERE:1,QUAD:2,NUM_SHAPE_TYPES:3}),Shape3D=function(t,s){this.longitudeBands=t,this.latitudeBands=s,this.vbo=null};Shape3D.prototype.bindBuffer=function(t,s,h,i){if(this.vbo){var e=Float32Array.BYTES_PER_ELEMENT,u=e*this.vbo.itemSize;t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.vertexAttribPointer(s,3,t.FLOAT,!1,u,0),this.vbo.itemSize>5&&t.vertexAttribPointer(h,3,t.FLOAT,!1,u,3*e),5==this.vbo.itemSize?t.vertexAttribPointer(i,2,t.FLOAT,!1,u,3*e):8==this.vbo.itemSize&&t.vertexAttribPointer(i,2,t.FLOAT,!1,u,6*e)}},Shape3D.prototype.render=function(t){this.vbo&&t.drawArrays(t.TRIANGLE_STRIP,0,this.vbo.numItems)},Shape3D.calcIntersectDistances=function(t,s,h){var i=s*s-4*t*h;return Math.abs(i)<1e-4?[s/(2*t)]:0>i?[]:[(s+i)/(2*t),(s-i)/(2*t)]},Quad.prototype=Object.create(Shape3D.prototype),Quad.prototype.constructor=Quad,Quad.prototype.createVBO=function(t,s,h){for(var i,e=[],u=-this.halfHeight,a=0,p=1/this.longitudeBands,r=p*this.halfHeight*2-this.halfHeight,n=1;n<=this.longitudeBands;n++){for(var o=0;o<=this.latitudeBands;o++)y=o/this.latitudeBands*this.halfHeight*2-this.halfHeight,i=1-o/this.latitudeBands,e.push(u),e.push(y),e.push(0),s&&(e.push(0),e.push(0),e.push(1)),h&&(e.push(a),e.push(i)),e.push(r),e.push(y),e.push(0),s&&(e.push(0),e.push(0),e.push(1)),h&&(e.push(p),e.push(i));n<this.longitudeBands&&(e.push(r),e.push(y),e.push(0),s&&(e.push(0),e.push(0),e.push(1)),h&&(e.push(a),e.push(i)),u=r,a=p,p=(n+1)/this.longitudeBands,r=p*this.halfHeight*2-this.halfHeight,e.push(u),e.push(-this.halfHeight),e.push(0),s&&(e.push(0),e.push(0),e.push(1)),h&&(e.push(p),e.push(1)))}this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),this.vbo.itemSize=3,s&&(this.vbo.itemSize+=3),h&&(this.vbo.itemSize+=2),this.vbo.numItems=e.length/this.vbo.itemSize},Quad.intersectsRay=function(){return!1},Cylinder.prototype=Object.create(Shape3D.prototype),Cylinder.prototype.constructor=Cylinder,Cylinder.prototype.createVBO=function(t,s,h){for(var i,e,u=[],a=1,p=0,r=1,n=1-1/this.longitudeBands,o=2*Math.PI/this.longitudeBands,d=Math.cos(o),c=Math.sin(o),l=1;l<=this.longitudeBands;l++){for(var v=0;v<=this.latitudeBands;v++)i=v/this.latitudeBands*this.halfHeight*2-this.halfHeight,e=1-v/this.latitudeBands,u.push(d*this.radius),u.push(i),u.push(c*this.radius),s&&(u.push(d),u.push(0),u.push(c)),h&&(u.push(n),u.push(e)),u.push(a*this.radius),u.push(i),u.push(p*this.radius),s&&(u.push(a),u.push(0),u.push(p)),h&&(u.push(r),u.push(e));l<this.longitudeBands&&(u.push(a*this.radius),u.push(i),u.push(p*this.radius),s&&(u.push(a),u.push(0),u.push(p)),h&&(u.push(r),u.push(e)),a=d,p=c,r=n,o=2*(l+1)*Math.PI/this.longitudeBands,d=Math.cos(o),c=Math.sin(o),n=1-(l+1)/this.longitudeBands,u.push(d*this.radius),u.push(-this.halfHeight),u.push(c*this.radius),s&&(u.push(d),u.push(0),u.push(c)),h&&(u.push(n),u.push(1)))}this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(u),t.STATIC_DRAW),this.vbo.itemSize=3,s&&(this.vbo.itemSize+=3),h&&(this.vbo.itemSize+=2),this.vbo.numItems=u.length/this.vbo.itemSize},Cylinder.intersectsRay=function(t,s,h,i){var e=vec3.create(),u=vec3.create(),a=vec3.create(),p=vec3.create();vec3.subtract(e,h,i),vec3.subtract(u,t,i),vec3.cross(a,s,e),vec3.cross(p,u,e);var r=vec3.dot(a,a),n=2*vec3.dot(a,p),o=vec3.dot(p,p)-vec3.dot(e,e),d=Shape3D.calcIntersectDistances(r,n,o);return d.length>0?!0:!1},Sphere.prototype=Object.create(Shape3D.prototype),Sphere.prototype.constructor=Sphere,Sphere.prototype.createVBO=function(t,s,h){var i,e,u,a,p,r,n,o,d,c,l,v=[],f=0,b=1;c=1-1/this.longitudeBands;for(var B=1;B<=this.longitudeBands;B++){i=2*B*Math.PI/this.longitudeBands,e=Math.sin(i),u=Math.cos(i),v.push(0),v.push(1*this.radius),v.push(0),s&&(v.push(0),v.push(1),v.push(0)),h&&(v.push(c),v.push(0));for(var S=1;S<this.latitudeBands;S++)a=S*Math.PI/this.latitudeBands,p=Math.sin(a),r=Math.cos(a),n=u*p,o=r,d=e*p,c=1-B/this.longitudeBands,l=S/this.latitudeBands,v.push(n*this.radius),v.push(o*this.radius),v.push(d*this.radius),s&&(v.push(n),v.push(o),v.push(d)),h&&(v.push(c),v.push(l)),n=b*p,o=r,d=f*p,c=1-(B-1)/this.longitudeBands,l=S/this.latitudeBands,v.push(n*this.radius),v.push(o*this.radius),v.push(d*this.radius),s&&(v.push(n),v.push(o),v.push(d)),h&&(v.push(c),v.push(l));v.push(0),v.push(-1*this.radius),v.push(0),s&&(v.push(0),v.push(-1),v.push(0)),h&&(v.push(c),v.push(1)),B<this.longitudeBands&&(v.push(0),v.push(-1*this.radius),v.push(0),s&&(v.push(0),v.push(-1),v.push(0)),h&&(v.push(c),v.push(1)),c=1-B/this.longitudeBands,v.push(0),v.push(1*this.radius),v.push(0),s&&(v.push(0),v.push(1),v.push(0)),h&&(v.push(c),v.push(0))),f=e,b=u}this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(v),t.STATIC_DRAW),this.vbo.itemSize=3,s&&(this.vbo.itemSize+=3),h&&(this.vbo.itemSize+=2),this.vbo.numItems=v.length/this.vbo.itemSize},Sphere.intersectsRay=function(t,s,h,i){var e=vec4.create();vec3.subtract(e,t,h);var u=2*vec3.dot(s,e),h=vec3.dot(e,e)-i*i,a=Shape3D.calcIntersectDistances(1,u,h);return a.length>0?!0:!1};